<!doctype html>
<html>
   <body>
      <canvas width = "800" height = "600" id = "my_Canvas"></canvas>

      <script>
       
         var canvas = document.getElementById('my_Canvas');
         gl = canvas.getContext('experimental-webgl');

         document.addEventListener('click', () => {
            canvas.requestPointerLock = canvas.requestPointerLock || 
                                     canvas.mozRequestPointerLock || 
                                     canvas.webkitRequestPointerLock;
            canvas.requestPointerLock();
         });

         document.addEventListener('mousemove', (e) => {
               if (document.pointerLockElement === canvas) {
                  mouseX = e.movementX;
                  mouseY = e.movementY;
                  xAngle -= mouseY*0.001;
                  yAngle += mouseX*0.001;
               }
         });

         var keys = {
            "w":false,
            "a":false,
            "s":false,
            "d":false
         };
         document.addEventListener('keydown', (e) => {
            if (e.key in keys) {
               keys[e.key] = true;
            }
         });

         document.addEventListener('keyup', (e) => {
            if (e.key in keys) {
               keys[e.key] = false;
            }
         });


         var vertices = [
            -1,0,-1, 1,1,1, 0,0, 1,0,-1, 1,1,1, 1000,0, 1,0,1, 1,1,1, 1000,1000, 1,0,1, 1,1,1, 1000,1000, -1,0,-1, 1,1,1, 0,0, -1,0,1, 1,1,1, 0,1000, // ground

            
            0.755188,0.0,0.236577,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,1.0,      0.629863,0.408184,0.003875,   0.989922235513761,0.989922235513761,0.989922235513761,   0.933013,0.75,      0.420653,0.681836,0.050294,   0.989922235513761,0.989922235513761,0.989922235513761,   0.933013,0.25,
      0.755188,0.0,0.236577,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,1.0,      0.420653,0.681836,0.050294,   0.989922235513761,0.989922235513761,0.989922235513761,   0.933013,0.25,      0.135188,0.692275,0.387458,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,0.0,
      0.755188,0.0,0.236577,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,1.0,      0.135188,0.692275,0.387458,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,0.0,      0.206469,0.404311,0.603985,   0.989922235513761,0.989922235513761,0.989922235513761,   0.066987,0.25,
      0.755188,0.0,0.236577,   0.989922235513761,0.989922235513761,0.989922235513761,   0.5,1.0,      0.206469,0.404311,0.603985,   0.989922235513761,0.989922235513761,0.989922235513761,   0.066987,0.25,      0.477912,0.0,0.615121,   0.989922235513761,0.989922235513761,0.989922235513761,   0.066987,0.75,
      -0.008878,0.0,0.769289,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,1.0,      0.206469,0.404311,0.603985,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.933013,0.75,      0.135188,0.692275,0.387458,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.933013,0.25,
      -0.008878,0.0,0.769289,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,1.0,      0.135188,0.692275,0.387458,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.933013,0.25,      -0.326837,0.664954,0.23496,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,0.0,
      -0.008878,0.0,0.769289,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,1.0,      -0.326837,0.664954,0.23496,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,0.0,      -0.545876,0.338237,0.379919,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.066987,0.25,
      -0.008878,0.0,0.769289,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.5,1.0,      -0.545876,0.338237,0.379919,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.066987,0.25,      -0.464426,0.0,0.612229,   0.6511054327692787,0.6511054327692787,0.6511054327692787,   0.066987,0.75,
      -0.762037,0.0,0.230385,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,1.0,      -0.545876,0.338237,0.379919,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.933013,0.75,      -0.326837,0.664954,0.23496,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.933013,0.25,
      -0.762037,0.0,0.230385,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,1.0,      -0.326837,0.664954,0.23496,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.933013,0.25,      -0.364764,0.628334,-0.320401,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,0.0,
      -0.762037,0.0,0.230385,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,1.0,      -0.364764,0.628334,-0.320401,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,0.0,      -0.530555,0.320168,-0.517115,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.066987,0.25,
      -0.762037,0.0,0.230385,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.5,1.0,      -0.530555,0.320168,-0.517115,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.066987,0.25,      -0.753934,0.0,-0.231005,   0.5279500953764793,0.5279500953764793,0.5279500953764793,   0.066987,0.75,
      -0.420552,0.0,-0.731639,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,1.0,      -0.530555,0.320168,-0.517115,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.933013,0.75,      -0.364764,0.628334,-0.320401,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.933013,0.25,
      -0.420552,0.0,-0.731639,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,1.0,      -0.364764,0.628334,-0.320401,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.933013,0.25,      0.123553,0.641804,-0.402484,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,0.0,
      -0.420552,0.0,-0.731639,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,1.0,      0.123553,0.641804,-0.402484,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,0.0,      0.21977,0.331538,-0.651207,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.066987,0.25,
      -0.420552,0.0,-0.731639,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.5,1.0,      0.21977,0.331538,-0.651207,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.066987,0.25,      0.008934,0.0,-0.866486,   0.7486210389011219,0.7486210389011219,0.7486210389011219,   0.066987,0.75,
      0.493267,0.0,-0.675932,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,1.0,      0.21977,0.331538,-0.651207,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.933013,0.75,      0.123553,0.641804,-0.402484,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.933013,0.25,
      0.493267,0.0,-0.675932,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,1.0,      0.123553,0.641804,-0.402484,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.933013,0.25,      0.420653,0.681836,0.050294,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,0.0,
      0.493267,0.0,-0.675932,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,1.0,      0.420653,0.681836,0.050294,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,0.0,      0.629863,0.408184,0.003875,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.066987,0.25,
      0.493267,0.0,-0.675932,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.5,1.0,      0.629863,0.408184,0.003875,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.066987,0.25,      0.771159,0.0,-0.246798,   0.7242142896493419,0.7242142896493419,0.7242142896493419,   0.066987,0.75,
      0.135188,0.692275,0.387458,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.5,1.0,      0.420653,0.681836,0.050294,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.975528,0.654508,      0.123553,0.641804,-0.402484,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.793893,0.095491,
      0.135188,0.692275,0.387458,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.5,1.0,      0.123553,0.641804,-0.402484,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.793893,0.095491,      -0.364764,0.628334,-0.320401,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.206107,0.095492,
      0.135188,0.692275,0.387458,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.5,1.0,      -0.364764,0.628334,-0.320401,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.206107,0.095492,      -0.326837,0.664954,0.23496,   0.5329709538931806,0.5329709538931806,0.5329709538931806,   0.024472,0.654509,
      0.493267,0.0,-0.675932,   0.6889379953779802,0.6889379953779802,0.6889379953779802,   0.0,0.0,      0.008934,0.0,-0.866486,   0.6889379953779802,0.6889379953779802,0.6889379953779802,   1.0,0.0,      0.21977,0.331538,-0.651207,   0.6889379953779802,0.6889379953779802,0.6889379953779802,   1.0,1.0,
      -0.420552,0.0,-0.731639,   0.8188417314322127,0.8188417314322127,0.8188417314322127,   0.0,0.0,      -0.753934,0.0,-0.231005,   0.8188417314322127,0.8188417314322127,0.8188417314322127,   1.0,0.0,      -0.530555,0.320168,-0.517115,   0.8188417314322127,0.8188417314322127,0.8188417314322127,   1.0,1.0,
      -0.762037,0.0,0.230385,   0.7416061113093719,0.7416061113093719,0.7416061113093719,   0.0,0.0,      -0.464426,0.0,0.612229,   0.7416061113093719,0.7416061113093719,0.7416061113093719,   1.0,0.0,      -0.545876,0.338237,0.379919,   0.7416061113093719,0.7416061113093719,0.7416061113093719,   1.0,1.0,
      -0.008878,0.0,0.769289,   0.7679721707673244,0.7679721707673244,0.7679721707673244,   0.0,0.0,      0.477912,0.0,0.615121,   0.7679721707673244,0.7679721707673244,0.7679721707673244,   1.0,0.0,      0.206469,0.404311,0.603985,   0.7679721707673244,0.7679721707673244,0.7679721707673244,   1.0,1.0,
      0.755188,0.0,0.236577,   0.92563632608978,0.92563632608978,0.92563632608978,   0.0,0.0,      0.771159,0.0,-0.246798,   0.92563632608978,0.92563632608978,0.92563632608978,   1.0,0.0,      0.629863,0.408184,0.003875,   0.92563632608978,0.92563632608978,0.92563632608978,   1.0,1.0,



   ];
       


var texture = gl.createTexture();
const img = new Image();

img.crossOrigin = '';
img.src = "textures/stone_texture.png";

img.onload = function() {

gl.activeTexture(gl.TEXTURE0);

  gl.bindTexture(gl.TEXTURE_2D, texture);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
  gl.generateMipmap(gl.TEXTURE_2D);

};


var texture2 = gl.createTexture();
const img2 = new Image();

img2.crossOrigin = '';
img2.src = "textures/grass.png";

img2.onload = function() {

gl.activeTexture(gl.TEXTURE0);

  gl.bindTexture(gl.TEXTURE_2D, texture2);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img2);
  gl.generateMipmap(gl.TEXTURE_2D);

};




         var vertex_buffer = gl.createBuffer();


         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);
         
  
         gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);


         gl.bindBuffer(gl.ARRAY_BUFFER, null);

         var vertCode =
            'attribute vec3 coordinates;' +
            'attribute vec3 aColor;' +
            'attribute vec2 aTexture;' +
            'varying vec3 vColor;' +
            'varying vec2 vTexture;' +
            'uniform mat4 projection;'+
            'uniform mat4 view;'+
            'uniform mat4 model;'+
            'void main() {' +
               ' vColor = aColor;'+
               ' vTexture = aTexture;'+
               ' gl_Position = projection*view*model*vec4(coordinates, 1.0);' +
            '}';
            
 
         var vertShader = gl.createShader(gl.VERTEX_SHADER);

         gl.shaderSource(vertShader, vertCode);


         gl.compileShader(vertShader);


         var fragCode = 'precision mediump float;' +
            'uniform sampler2D uSampler;' +
            'varying vec3 vColor;' +
            'varying vec2 vTexture;' +
            'void main() {' +
             //  ' gl_FragColor = texture2D(uSampler, vTexture);' +
              'gl_FragColor = texture2D(uSampler, vTexture)*vec4(vColor, 1.0);' +
            '}';
            

         var fragShader = gl.createShader(gl.FRAGMENT_SHADER);


         gl.shaderSource(fragShader, fragCode); 
         

         gl.compileShader(fragShader);


         var shaderProgram = gl.createProgram();


         gl.attachShader(shaderProgram, vertShader);

         gl.attachShader(shaderProgram, fragShader);


         gl.linkProgram(shaderProgram);







         gl.useProgram(shaderProgram);

         var pLoc = gl.getUniformLocation(shaderProgram, "projection");
         var vLoc = gl.getUniformLocation(shaderProgram, "view");
         var mLoc = gl.getUniformLocation(shaderProgram, "model");

         var uSamplerPos = gl.getUniformLocation(shaderProgram, "uSampler");
         gl.uniform1i(uSamplerPos, 0);


         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);


         

         var coordPos = gl.getAttribLocation(shaderProgram, "coordinates");


         gl.vertexAttribPointer(coordPos, 3, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 0); 
         

         gl.enableVertexAttribArray(coordPos);

         var colorPos = gl.getAttribLocation(shaderProgram, "aColor");


         gl.vertexAttribPointer(colorPos, 3, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 3 * Float32Array.BYTES_PER_ELEMENT); 
         

         gl.enableVertexAttribArray(colorPos);


         var texturePos = gl.getAttribLocation(shaderProgram, "aTexture");


         gl.vertexAttribPointer(texturePos, 2, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 6 * Float32Array.BYTES_PER_ELEMENT); 
         

         gl.enableVertexAttribArray(texturePos);

       

         var ang = Math.tan((40*0.5)*Math.PI/180);
         var projMatrix = [0.5/ang, 0 , 0, 0,
                           0, 0.5*(canvas.width/canvas.height)/ang, 0, 0,
                           0, 0, -(100+1)/(100-1), -1,
                           0, 0, (-2*100*1)/(100-1), 0 
                        ];
         var viewMatrix = [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1];
         var modelMatrix = [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1];



         function rotateZ(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv0 = m[0], mv4 = m[4], mv8 = m[8];

            m[0] = c*m[0]-s*m[1];
            m[4] = c*m[4]-s*m[5];
            m[8] = c*m[8]-s*m[9];

            m[1]=c*m[1]+s*mv0;
            m[5]=c*m[5]+s*mv4;
            m[9]=c*m[9]+s*mv8;
         }

         function rotateY(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv1 = m[1], mv5 = m[5], mv9 = m[9];

            m[1] = m[1]*c-m[2]*s;
            m[5] = m[5]*c-m[6]*s;
            m[9] = m[9]*c-m[10]*s;

            m[2] = m[2]*c+mv1*s;
            m[6] = m[6]*c+mv5*s;
            m[10] = m[10]*c+mv9*s;
         }

         function rotateX(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv0 = m[0], mv4 = m[4], mv8 = m[8];

            m[0] = c*m[0]+s*m[2];
            m[4] = c*m[4]+s*m[6];
            m[8] = c*m[8]+s*m[10];

            m[2] = c*m[2]-s*mv0;
            m[6] = c*m[6]-s*mv4;
            m[10] = c*m[10]-s*mv8;
         }

         function lookAt(eye, front) {
            const up = [0, 1, 0];
            const frontNorm = normalize(front);
            const right = normalize(crossProduct(up, frontNorm));           
            const upNorm = normalize(crossProduct(frontNorm, right));

            return [
               right[0], upNorm[0], -frontNorm[0], 0,
               right[1], upNorm[1], -frontNorm[1], 0,
               right[2], upNorm[2], -frontNorm[2], 0,
               -dotProduct(right, eye), -dotProduct(upNorm, eye), dotProduct(frontNorm, eye), 1
            ];
         }


         function normalize(v) {
            const length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);
            return [v[0] / length, v[1] / length, v[2] / length];
         }

         function crossProduct(a, b) {
            return [
               a[1] * b[2] - a[2] * b[1],
               a[2] * b[0] - a[0] * b[2],
               a[0] * b[1] - a[1] * b[0]
            ];
         }

         function dotProduct(a, b) {
            return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
         }




         gl.viewport(0,0,canvas.width,canvas.height);


         let cameraPos = [0, 2, 3];
         let front = [0, 0, -1]     
         let xAngle = 0;             
         let yAngle = Math.PI;
         let speed = 0.3;   

         function gameloop() {
            cosa = Math.cos(yAngle);
            sina = Math.sin(yAngle);
            front = [Math.cos(xAngle) * sina, Math.sin(xAngle), Math.cos(xAngle) * cosa]

            if (keys["w"]) {
               cameraPos[0] += sina * speed;
               cameraPos[2] += cosa * speed;
            }
            if (keys["a"]) {
               cameraPos[0] -= cosa * speed;
               cameraPos[2] += sina * speed;
            }
            if (keys["s"]) {
               cameraPos[0] -= sina * speed;
               cameraPos[2] -= cosa * speed;
            }
            if (keys["d"]) {
               cameraPos[0] += cosa * speed;
               cameraPos[2] -= sina * speed;
            }

            gl.clearColor(0.57, 0.79, 0.98, 1.0);

            gl.enable(gl.DEPTH_TEST);


            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            
            viewMatrix = lookAt(cameraPos, front);






            gl.bindTexture(gl.TEXTURE_2D, texture2);



            modelMatrix = [1000,0,0,0, 0,1000,0,0, 0,0,1000,0, 0,0,0,1];
            gl.uniformMatrix4fv(pLoc, false, projMatrix);
            gl.uniformMatrix4fv(vLoc, false, viewMatrix);
            gl.uniformMatrix4fv(mLoc, false, modelMatrix);

            gl.drawArrays(gl.TRIANGLES, 0, 6);

            gl.bindTexture(gl.TEXTURE_2D, texture);
            modelMatrix = [2,0,0,0, 0,2,0,0, 0,0,2,0, 0,0,0,1];
            gl.uniformMatrix4fv(mLoc, false, modelMatrix);

            gl.drawArrays(gl.TRIANGLES, 6, vertices.length/2-6);
         }

         setInterval(gameloop, 1000 / 30);
      </script>
    </body>
</html>