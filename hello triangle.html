<!doctype html>
<html>
   <body>
      <canvas width = "800" height = "600" id = "my_Canvas"></canvas>

      <script>
       
         var canvas = document.getElementById('my_Canvas');
         gl = canvas.getContext('experimental-webgl');

         document.addEventListener('click', () => {
            canvas.requestPointerLock = canvas.requestPointerLock || 
                                     canvas.mozRequestPointerLock || 
                                     canvas.webkitRequestPointerLock;
            canvas.requestPointerLock();
         });

         document.addEventListener('mousemove', (e) => {
               if (document.pointerLockElement === canvas) {
                  mouseX = e.movementX;
                  mouseY = e.movementY;
                  xAngle -= mouseY*0.001;
                  yAngle += mouseX*0.001;
               }
         });

         var keys = {
            "w":false,
            "a":false,
            "s":false,
            "d":false
         };
         document.addEventListener('keydown', (e) => {
            if (e.key in keys) {
               keys[e.key] = true;
            }
         });

         document.addEventListener('keyup', (e) => {
            if (e.key in keys) {
               keys[e.key] = false;
            }
         });


         var vertices = [
            -1,0,-1, 0,0.5,0, 1,0,-1, 0,0.5,0, 1,0,1, 0,0.5,0, 1,0,1, 0,0.5,0, -1,0,-1, 0,0.5,0, -1,0,1, 0,0.5,0, // ground

         0.746341,0.0,0.230801,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.656733,0.430465,0.0,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.412566,0.650941,0.058112,   0.5983397663222878,0.5983397663222878,0.5983397663222878,
0.746341,0.0,0.230801,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.412566,0.650941,0.058112,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.127487,0.683647,0.373445,   0.5983397663222878,0.5983397663222878,0.5983397663222878,
0.746341,0.0,0.230801,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.127487,0.683647,0.373445,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.216895,0.431983,0.635348,   0.5983397663222878,0.5983397663222878,0.5983397663222878,
0.746341,0.0,0.230801,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.216895,0.431983,0.635348,   0.5983397663222878,0.5983397663222878,0.5983397663222878,0.461264,0.0,0.604253,   0.5983397663222878,0.5983397663222878,0.5983397663222878,
0.0,0.0,0.746898,   0.5733726900886069,0.5733726900886069,0.5733726900886069,0.216895,0.431983,0.635348,   0.5733726900886069,0.5733726900886069,0.5733726900886069,0.127487,0.683647,0.373445,   0.5733726900886069,0.5733726900886069,0.5733726900886069,
0.0,0.0,0.746898,   0.5733726900886069,0.5733726900886069,0.5733726900886069,0.127487,0.683647,0.373445,   0.5733726900886069,0.5733726900886069,0.5733726900886069,-0.333771,0.683647,0.2308,   0.5733726900886069,0.5733726900886069,0.5733726900886069,
0.0,0.0,0.746898,   0.5733726900886069,0.5733726900886069,0.5733726900886069,-0.333771,0.683647,0.2308,   0.5733726900886069,0.5733726900886069,0.5733726900886069,-0.56785,0.359418,0.392663,   0.5733726900886069,0.5733726900886069,0.5733726900886069,
0.0,0.0,0.746898,   0.5733726900886069,0.5733726900886069,0.5733726900886069,-0.56785,0.359418,0.392663,   0.5733726900886069,0.5733726900886069,0.5733726900886069,-0.461264,0.0,0.604253,   0.5733726900886069,0.5733726900886069,0.5733726900886069,
-0.746341,0.0,0.230801,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.56785,0.359418,0.392663,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.333771,0.683647,0.2308,   0.5542228029982925,0.5542228029982925,0.5542228029982925,
-0.746341,0.0,0.230801,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.333771,0.683647,0.2308,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.333771,0.574645,-0.309413,   0.5542228029982925,0.5542228029982925,0.5542228029982925,
-0.746341,0.0,0.230801,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.333771,0.574645,-0.309413,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.56785,0.359418,-0.538387,   0.5542228029982925,0.5542228029982925,0.5542228029982925,
-0.746341,0.0,0.230801,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.56785,0.359418,-0.538387,   0.5542228029982925,0.5542228029982925,0.5542228029982925,-0.746341,0.0,-0.230801,   0.5542228029982925,0.5542228029982925,0.5542228029982925,
-0.40955,0.0,-0.688039,   0.7238879873229187,0.7238879873229187,0.7238879873229187,-0.56785,0.359418,-0.538387,   0.7238879873229187,0.7238879873229187,0.7238879873229187,-0.333771,0.574645,-0.309413,   0.7238879873229187,0.7238879873229187,0.7238879873229187,
-0.40955,0.0,-0.688039,   0.7238879873229187,0.7238879873229187,0.7238879873229187,-0.333771,0.574645,-0.309413,   0.7238879873229187,0.7238879873229187,0.7238879873229187,0.127487,0.682858,-0.414821,   0.7238879873229187,0.7238879873229187,0.7238879873229187,
-0.40955,0.0,-0.688039,   0.7238879873229187,0.7238879873229187,0.7238879873229187,0.127487,0.682858,-0.414821,   0.7238879873229187,0.7238879873229187,0.7238879873229187,0.216895,0.316459,-0.635348,   0.7238879873229187,0.7238879873229187,0.7238879873229187,
-0.40955,0.0,-0.688039,   0.7238879873229187,0.7238879873229187,0.7238879873229187,0.216895,0.316459,-0.635348,   0.7238879873229187,0.7238879873229187,0.7238879873229187,0.0,0.0,-0.901586,   0.7238879873229187,0.7238879873229187,0.7238879873229187,
0.508497,0.0,-0.685735,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.216895,0.316459,-0.635348,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.127487,0.682858,-0.414821,   0.6666373891460342,0.6666373891460342,0.6666373891460342,
0.508497,0.0,-0.685735,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.127487,0.682858,-0.414821,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.412566,0.650941,0.058112,   0.6666373891460342,0.6666373891460342,0.6666373891460342,
0.508497,0.0,-0.685735,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.412566,0.650941,0.058112,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.656733,0.430465,0.0,   0.6666373891460342,0.6666373891460342,0.6666373891460342,
0.508497,0.0,-0.685735,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.656733,0.430465,0.0,   0.6666373891460342,0.6666373891460342,0.6666373891460342,0.746341,0.0,-0.230801,   0.6666373891460342,0.6666373891460342,0.6666373891460342,
0.127487,0.683647,0.373445,   0.6150592154282077,0.6150592154282077,0.6150592154282077,0.412566,0.650941,0.058112,   0.6150592154282077,0.6150592154282077,0.6150592154282077,0.127487,0.682858,-0.414821,   0.6150592154282077,0.6150592154282077,0.6150592154282077,
0.127487,0.683647,0.373445,   0.6150592154282077,0.6150592154282077,0.6150592154282077,0.127487,0.682858,-0.414821,   0.6150592154282077,0.6150592154282077,0.6150592154282077,-0.333771,0.574645,-0.309413,   0.6150592154282077,0.6150592154282077,0.6150592154282077,
0.127487,0.683647,0.373445,   0.6150592154282077,0.6150592154282077,0.6150592154282077,-0.333771,0.574645,-0.309413,   0.6150592154282077,0.6150592154282077,0.6150592154282077,-0.333771,0.683647,0.2308,   0.6150592154282077,0.6150592154282077,0.6150592154282077,
0.508497,0.0,-0.685735,   0.6054678554366808,0.6054678554366808,0.6054678554366808,0.0,0.0,-0.901586,   0.6054678554366808,0.6054678554366808,0.6054678554366808,0.216895,0.316459,-0.635348,   0.6054678554366808,0.6054678554366808,0.6054678554366808,
-0.40955,0.0,-0.688039,   0.5084259061774371,0.5084259061774371,0.5084259061774371,-0.746341,0.0,-0.230801,   0.5084259061774371,0.5084259061774371,0.5084259061774371,-0.56785,0.359418,-0.538387,   0.5084259061774371,0.5084259061774371,0.5084259061774371,
-0.746341,0.0,0.230801,   0.4853630000088422,0.4853630000088422,0.4853630000088422,-0.461264,0.0,0.604253,   0.4853630000088422,0.4853630000088422,0.4853630000088422,-0.56785,0.359418,0.392663,   0.4853630000088422,0.4853630000088422,0.4853630000088422,
0.0,0.0,0.746898,   0.5871439149985519,0.5871439149985519,0.5871439149985519,0.461264,0.0,0.604253,   0.5871439149985519,0.5871439149985519,0.5871439149985519,0.216895,0.431983,0.635348,   0.5871439149985519,0.5871439149985519,0.5871439149985519,
0.746341,0.0,0.230801,   0.5135863956786385,0.5135863956786385,0.5135863956786385,0.746341,0.0,-0.230801,   0.5135863956786385,0.5135863956786385,0.5135863956786385,0.656733,0.430465,0.0,   0.5135863956786385,0.5135863956786385,0.5135863956786385,


];
         
         

         var vertex_buffer = gl.createBuffer();


         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);
         
  
         gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);


         gl.bindBuffer(gl.ARRAY_BUFFER, null);

         var vertCode =
            'attribute vec3 coordinates;' +
            'attribute vec3 aColor;' +
            'varying vec3 vColor;' +
            'uniform mat4 projection;'+
            'uniform mat4 view;'+
            'uniform mat4 model;'+
            'void main() {' +
               ' vColor = aColor;'+
               ' gl_Position = projection*view*model*vec4(coordinates, 1.0);' +
            '}';
            
 
         var vertShader = gl.createShader(gl.VERTEX_SHADER);

         gl.shaderSource(vertShader, vertCode);


         gl.compileShader(vertShader);


         var fragCode = 'precision mediump float;' +
            'varying vec3 vColor;' +
            'void main() {' +
               ' gl_FragColor = vec4(vColor, 1.0);' +
            '}';
            

         var fragShader = gl.createShader(gl.FRAGMENT_SHADER);


         gl.shaderSource(fragShader, fragCode); 
         

         gl.compileShader(fragShader);


         var shaderProgram = gl.createProgram();


         gl.attachShader(shaderProgram, vertShader);

         gl.attachShader(shaderProgram, fragShader);


         gl.linkProgram(shaderProgram);


         var pLoc = gl.getUniformLocation(shaderProgram, "projection");
         var vLoc = gl.getUniformLocation(shaderProgram, "view");
         var mLoc = gl.getUniformLocation(shaderProgram, "model");


         gl.useProgram(shaderProgram);


         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);


         

         var coordPos = gl.getAttribLocation(shaderProgram, "coordinates");


         gl.vertexAttribPointer(coordPos, 3, gl.FLOAT, false, 6 * Float32Array.BYTES_PER_ELEMENT, 0); 
         

         gl.enableVertexAttribArray(coordPos);

         var colorPos = gl.getAttribLocation(shaderProgram, "aColor");


         gl.vertexAttribPointer(colorPos, 3, gl.FLOAT, false, 6 * Float32Array.BYTES_PER_ELEMENT, 3 * Float32Array.BYTES_PER_ELEMENT); 
         

         gl.enableVertexAttribArray(colorPos);


         var ang = Math.tan((40*0.5)*Math.PI/180);
         var projMatrix = [0.5/ang, 0 , 0, 0,
                           0, 0.5*(canvas.width/canvas.height)/ang, 0, 0,
                           0, 0, -(100+1)/(100-1), -1,
                           0, 0, (-2*100*1)/(100-1), 0 
                        ];
         var viewMatrix = [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1];
         var modelMatrix = [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1];



         function rotateZ(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv0 = m[0], mv4 = m[4], mv8 = m[8];

            m[0] = c*m[0]-s*m[1];
            m[4] = c*m[4]-s*m[5];
            m[8] = c*m[8]-s*m[9];

            m[1]=c*m[1]+s*mv0;
            m[5]=c*m[5]+s*mv4;
            m[9]=c*m[9]+s*mv8;
         }

         function rotateY(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv1 = m[1], mv5 = m[5], mv9 = m[9];

            m[1] = m[1]*c-m[2]*s;
            m[5] = m[5]*c-m[6]*s;
            m[9] = m[9]*c-m[10]*s;

            m[2] = m[2]*c+mv1*s;
            m[6] = m[6]*c+mv5*s;
            m[10] = m[10]*c+mv9*s;
         }

         function rotateX(m, angle) {
            var c = Math.cos(angle);
            var s = Math.sin(angle);
            var mv0 = m[0], mv4 = m[4], mv8 = m[8];

            m[0] = c*m[0]+s*m[2];
            m[4] = c*m[4]+s*m[6];
            m[8] = c*m[8]+s*m[10];

            m[2] = c*m[2]-s*mv0;
            m[6] = c*m[6]-s*mv4;
            m[10] = c*m[10]-s*mv8;
         }

         function lookAt(eye, front) {
            const up = [0, 1, 0];
            const frontNorm = normalize(front);
            const right = normalize(crossProduct(up, frontNorm));           
            const upNorm = normalize(crossProduct(frontNorm, right));

            return [
               right[0], upNorm[0], -frontNorm[0], 0,
               right[1], upNorm[1], -frontNorm[1], 0,
               right[2], upNorm[2], -frontNorm[2], 0,
               -dotProduct(right, eye), -dotProduct(upNorm, eye), dotProduct(frontNorm, eye), 1
            ];
         }


         function normalize(v) {
            const length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);
            return [v[0] / length, v[1] / length, v[2] / length];
         }

         function crossProduct(a, b) {
            return [
               a[1] * b[2] - a[2] * b[1],
               a[2] * b[0] - a[0] * b[2],
               a[0] * b[1] - a[1] * b[0]
            ];
         }

         function dotProduct(a, b) {
            return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
         }




         gl.viewport(0,0,canvas.width,canvas.height);


         let cameraPos = [0, 2, 3];
         let front = [0, 0, -1]     
         let xAngle = 0;             
         let yAngle = Math.PI;
         let speed = 0.3;   

         function gameloop() {
            cosa = Math.cos(yAngle);
            sina = Math.sin(yAngle);
            front = [Math.cos(xAngle) * sina, Math.sin(xAngle), Math.cos(xAngle) * cosa]

            if (keys["w"]) {
               cameraPos[0] += sina * speed;
               cameraPos[2] += cosa * speed;
            }
            if (keys["a"]) {
               cameraPos[0] -= cosa * speed;
               cameraPos[2] += sina * speed;
            }
            if (keys["s"]) {
               cameraPos[0] -= sina * speed;
               cameraPos[2] -= cosa * speed;
            }
            if (keys["d"]) {
               cameraPos[0] += cosa * speed;
               cameraPos[2] -= sina * speed;
            }

            gl.clearColor(0.57, 0.79, 0.98, 1.0);

            gl.enable(gl.DEPTH_TEST);


            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            
            viewMatrix = lookAt(cameraPos, front);

            modelMatrix = [1000,0,0,0, 0,1000,0,0, 0,0,1000,0, 0,0,0,1];
            gl.uniformMatrix4fv(pLoc, false, projMatrix);
            gl.uniformMatrix4fv(vLoc, false, viewMatrix);
            gl.uniformMatrix4fv(mLoc, false, modelMatrix);

            gl.drawArrays(gl.TRIANGLES, 0, 6);


            modelMatrix = [2,0,0,0, 0,2,0,0, 0,0,2,0, 0,0,0,1];
            gl.uniformMatrix4fv(mLoc, false, modelMatrix);

            gl.drawArrays(gl.TRIANGLES, 6, vertices.length/2-6);
         }

         setInterval(gameloop, 1000 / 30);
      </script>
    </body>
</html>